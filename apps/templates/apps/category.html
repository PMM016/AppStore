{% extends "base.html" %}
{% load static %}

{% block title %}
{{ category.name }} | Apps
{% endblock %}

{% block extra_css %}
  {% if category.icon %}
    <link rel="icon" href="{{ category.icon.url }}">
  {% elif category.icon_url %}
    <link rel="icon" href="{{ category.icon_url }}">
  {% endif %}  
  <link rel="stylesheet" href="{% static 'css/apps.css' %}">
  <link rel="stylesheet" href="{% static 'css/nohead.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4 text-center">
  <h2 class="fw-bold mb-4">
    Category: {{ category.name }}
  </h2>
  <h4 class="subtitle">
    No of Apps: {{ apps|length }}
  </h4>
</div>

<div class="nav-crumb">
  <a class="btn btn-outline-secondary outlined" href="{% url 'back' %}">
    <i class="fa fa-chevron-left"></i> <span>Go Back</span> 
  </a>
</div>

{% if apps %}
  <div class="apps-container">
    {% for app in apps %}
      <div class="app-card">
        <div class="app-card-header d-flex">
          <div class="left">
            <span class="status status-{{ app.status }}">{{ app.get_status_display }}</span>
          </div>
          <div class="right d-flex">
            <button class="btn btn-outline-info" hx-get="{% url 'apps:edit' app.id %}" hx-target="#modal-content" hx-trigger="click" data-bs-toggle="modal" data-bs-target="#modal">
              <i class="fas fa-edit"></i>
            </button>
            <a class="btn btn-outline-danger" href="{% url 'apps:delete' app.id %}">
              <i class="fas fa-trash"></i>
            </a>
          </div>
        </div>
        {% if app.icon %}
          <img src="{{ app.icon.url }}" class="app-icon" loading="lazy" />
        {% elif app.icon_url %}
          <img src="{{ app.icon_url }}" class="app-icon" loading="lazy" />
        {% else %}
          <div class="app-icon"></div>
        {% endif %}
        <div class="app-card-body">
          <h5>{{ app.name }}</h5>
          <p class="subtitle mb-0">{{ app.use|truncatewords:3 }}</p>
          <div class="breadcrumb to-folder mt-2" style="line-height: 1;">
            <i class="fas fa-folder me-1"></i> Apps
            {% if app.sub_folder %}
              / {{ app.sub_folder.folder.title }}
              / {{ app.sub_folder.title }}
            {% elif app.folders.exists %}
              / {{ app.folders.first.title }}
            {% else %}
              / Other
            {% endif %}
          </div>
        </div>
        <div class="categories" tabindex="1">
          {% for category in app.categories.all %}
            <a href="{% url 'apps:category_detail' category.slug %}" class="badge d-flex align-items-center p-1 pe-2 text-success-emphasis bg-success-subtle border border-success-subtle rounded-pill">
              {% if category.icon %}
                <img src="{{ category.icon.url }}" class="category-icon rounded-circle me-1" width="24" height="24" loading="lazy" /> {{ category.name }}
              {% elif category.icon_url %}
                <img src="{{ category.icon_url }}" class="category-icon rounded-circle me-1" width="24" height="24" loading="lazy" /> {{ category.name }}
              {% elif category.icon_font %}
                <i class="{{ category.icon_font}} rounded-circle me-1"></i> {{ category.name }}
              {% else %}
                {{ category.name }}
              {% endif %}
            </a>
          {% endfor %}
        </div>
        <div class="card-action">
          <a class="btn btn-primary" href="{% url 'apps:view' app.id %}">View App</a>
        </div>
      </div>
    {% endfor %}
  </div>
  <!-- Pagination -->
  {% if apps.has_other_pages %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        {% if apps.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ apps.previous_page_number }}">
              <i class="fas fa-chevron-left"></i> Previous
            </a>
          </li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">
            Page {{ apps.number }} of {{ apps.paginator.num_pages }}
          </span>
        </li>

        {% if apps.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ apps.next_page_number }}">
              Next <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        {% endif %}

      </ul>
    </nav>
  {% endif %}
{% else %}
  <div class="alert alert-warning">
    No apps found in this category.
  </div>
{% endif %}

</div>
{% endblock %}
