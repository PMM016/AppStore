{% load static %}
<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}AppStore{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

  <!-- CSS Styles -->
  <link rel="stylesheet" href="{% static 'css/root.css' %}">
  <link rel="stylesheet" href="{% static 'css/nav.css' %}">
  <link rel="stylesheet" href="{% static 'scss/btnsweep.css' %}">

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>

  {% block extra_css %}{% endblock %}
</head>

<body class="bg-light">

  <!-- THEME TOGGLER --> 
  <div class="position-fixed bottom-0 end-0 p-3 z-abs">
    <div class="btn-group dropup"> 
      <button class="btn btn-lg btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
         <i class="bi bi-circle-half"></i> 
      </button> 

      <ul class="dropdown-menu shadow dropdown-menu-end">
        <li><button class="dropdown-item" onclick="setTheme('light')">Light</button></li>
        <li><button class="dropdown-item" onclick="setTheme('dark')">Dark</button></li> 
        <li><button class="dropdown-item" onclick="setTheme('auto')">Auto</button></li> 
      </ul> 
    </div> 
  </div> 

  <!-- DJANGO MESSAGES --> 
  {% if messages %} 
    <div class="alert-float"> 
      {% for message in messages %} 
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert"> 
          {{ message }} 
        </div> 
      {% endfor %} 
    </div> 
  {% endif %} 

  <div class="layout"> 
    <!-- ASYNC NAV --> 
    <div hx-get="{% url 'load_nav' %}" hx-trigger="load" hx-swap="outerHTML"> </div> 
    <main class="main-content"> {% block content %}{% endblock %} </main> 
  </div>

  <!-- GLOBAL MODAL (HTMX TARGET) -->
  <div class="modal fade" id="modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content" id="modal-content">
        <!-- HTMX loads content here -->
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- UX POLISH SCRIPTS -->
  <script>
    /* Auto-focus first field when modal opens */
    document.addEventListener("shown.bs.modal", function () {
      const input = document.querySelector(
        "#modal input:not([type=hidden]), #modal select, #modal textarea"
      );
      if (input) input.focus();
    });

    /* Enable Bootstrap tooltips globally */
    document.addEventListener("DOMContentLoaded", function () {
      const tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    /* Close modal on successful HTMX reload */
    document.body.addEventListener("htmx:afterRequest", function (evt) {
      if (evt.detail.xhr.responseText.includes("location.reload")) {
        const modalEl = document.getElementById("modal");
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) modal.hide();
      }
    });

    function setTheme(theme) { 
      document.documentElement.setAttribute('data-bs-theme', theme) 
      localStorage.setItem('theme', theme) } (() => { 
        const savedTheme = localStorage.getItem('theme') 
        if (savedTheme) { 
          document.documentElement.setAttribute('data-bs-theme', savedTheme) 
        } 
      })()
  </script>
  <script src="{% static 'js/script.js' %}"></script>
  {% block extra_js %}{% endblock %}
</body>
</html>

{% comment %}
document.addEventListener("htmx:afterSwap", () => {
      document 
        .querySelectorAll('[data-bs-toggle="tooltip"]') 
        .forEach(el => new bootstrap.Tooltip(el)) 
      }) 
      setTimeout(() => { 
        document.querySelectorAll('.alert').forEach(alert => {
          alert.classList.remove('show') 
          alert.classList.add('fade') }) 
        }, 5000) 
{% endcomment %}
